<div class="row">
  <div class="col-md-2 col-md-offset-1">
    <center>
      <div class='profile_pic'><%= image_tag(current_user.image) %></div>
      <h1><%= current_user.name %></h1>
      <%= link_to 'Log Out', logout_path %>
      <br>
      <%= link_to 'see local photos', local_path %>
    </center>
  </div>

  <div class="col-md-9 effects clearfix" id="slide-up">
    <!-- <div class="img">
      <div class="overlay">
        <a href="#" class="expand">+</a>
        <a class="close-overlay hidden">x</a>
      </div>
    </div> -->
  </div>

</div>

<script>
  $(document).on('ready', function() {
    $.when($.get("https://jsonp.afeld.me/?url=https://api.instagram.com/v1/users/self/media/liked?access_token=<%= current_user.token %>", function(data){
      $.each(data['data'], function(i, val) {
        if (val['videos'] === undefined) {
          if (val['caption'] === null) {
            $( ".col-md-9" ).append("<div class='img'><img src='" + val['images']['low_resolution']['url'] + "'><div class='overlay'><a href='#' class='expand'><h5>" + '<%= link_to 'Favorite This', photos_path, class: 'btn btn-success' %>' + "</h5> </a><a class='close-overlay hidden'>x</a></div></div>");
          } else {
            $( ".col-md-9" ).append("<div class='img'><img src='" + val['images']['low_resolution']['url'] + "'><div class='overlay'><a href='#' class='expand'><h5>" + val['caption']['text'] + '<%= link_to 'Favorite This', photos_path, class: 'btn btn-success' %>' + "</h5> </a><a class='close-overlay hidden'>x</a></div></div>");
          }
        } else {
          $( ".col-md-9" ).append("<div class='img'><video width='320' height='320' controls><source src='" + val['videos']['low_resolution']['url'] + "'  type='video/mp4'/></video></div>");
        }
      });
    })).done(function hoverEffects (){
        // handle the mouseenter functionality
      $(".img").mouseenter(function(){
          $(this).addClass("hover");
          $('.btn').on('click', function(){
            var closestImg = $(this).closest('.img');
            var photoUrl = closestImg.children().attr('src');
            $.ajax({
              url: '/photos',
              type: 'POST',
              data: JSON.stringify({url: photoUrl}),
              contentType: 'application/json',
              dataType: 'json'
            });
          });
      })
      // handle the mouseleave functionality
      .mouseleave(function(){
          $(this).removeClass("hover");
      });
    });
  });

</script>
